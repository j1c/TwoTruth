---
title: "On a `Two Truths` Phenomenon in Spectral Graph Clustering"
output: 
  bookdown::html_document2:
    code_folding: show
    keep_md: true
#    css: ~/RFolder/pandoc.css
    fig_caption: yes
    fig_height: 4.5
    fig_width: 4.5
    number_sections: yes
    toc: yes
    toc_depth: 2
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE, results='asis'}
suppressMessages(library(kableExtra))
#suppressMessages(library(captioner))
#tab_nums <- captioner(prefix="Table")
#fig_nums <- captioner()

suppressMessages(library(tidyverse))

library(knitr)
knitr::opts_chunk$set(echo=TRUE, eval=FALSE,warning=FALSE)

opts_knit$set(aliases=c(h='fig.height', w='fig.width', cap='fig.cap', scap='fig.scap'))                                                                               
opts_knit$set(eval.after = c('fig.cap','fig.scap'))                                                                            
knit_hooks$set(document = function(x) {                                                                                        
          gsub('(\\\\end\\{knitrout\\}[\n]+)', '\\1\\\\noindent ', x)                                                                  
          })

```

**[Department of Applied Mathematics and Statistics](http://engineering.jhu.edu/ams/)**      
**[Center for Imaging Science](http://www.cis.jhu.edu)**  
**[Department of Biomedical Engineering](http://engineering.jhu.edu/bme/)**      
**[Human Language Technology Center of Excellence](http://hltcoe.jhu.edu)**  
**[Johns Hopkins University](http://www.jhu.edu)**  
and  
**[University of Massachusetts, Amherst, MA](http://umass.edu)**  
and  
**[Institute for Defense Analyses, Center for Computing Science]()**  

-----

> Carey E. Priebe, Youngser Park, Joshua T. Vogelstein, John M. Conroy, Vince Lyzinskic, Minh Tang, Avanti Athreya, Joshua Cape, and Eric Bridgeford, "[On a 'Two Truths' Phenomenon in Spectral Graph Clustering](http://arxiv.org/abs/xxxx)," _Proceedings of National Academy of Science_, submitted, 2018.


# Abstract

Clustering is concerned with coherently grouping observations without any explicit concept of true groupings. Spectral graph clustering -- clustering the vertices of a graph based on their spectral embedding -- is commonly approached via K-means (or, more generally, Gaussian mixture model) clustering composed with either Laplacian or Adjacency spectral embedding (LSE or ASE).
Recent theoretical results provide new understanding of the problem and solutions, and lead us to a 'Two Truths' LSE vs. ASE spectral graph clustering phenomenon
convincingly illustrated here via a diffusion MRI connectome data set:
 the different embedding methods yield different clustering results,
 with LSE capturing left hemisphere/right hemisphere affinity structure
 and ASE capturing gray matter/white matter core-periphery structure.
 
> **Keywords**: Spectral Embedding, Spectral Clustering, Graph, Network, Connectome

<figure>
<img src="vignettes/killerfig-cep-g1.jpg" width="700px" />
  <figcaption>Figure 1. Illustration of the Two Truths phenomenon.</figcaption>
</figure>


# Supplemental Information (SI)

## Data

Here we make available the connectome data used for our illustration:
$m = 114$ graphs on $n \approx 40,000$ vertices, 
and for each graph every vertex has a {Left,Right} label and a {Gray,White} label.

NB:
The original diffusion MRI connectomes are symmetric, hollow, and weighted.
This is not meant to be a finding of neurscientific significance;
rather, this is an illustration of the 'Two Truths' phenomenon.
As such, we consider the largest connected component of binarized versions of the connectomes.

The $m=114$ binary symmetric hollow graphs with $n_i \approx 40K$ vertices and vertex label attributes can be downloaded as an `R` object as following:

```{r, echo=TRUE, eval=FALSE}
print(load(url("http://www.cis.jhu.edu/~parky/TT/Data/TT-glist114-binary.rda"))) 
# ~4GB, may take several minutes to load
#[1] "glist"
length(glist)
#[1] 114

library(igraph)
summary(glist[[1]])
#IGRAPH b40d5fe UNW- 40813 2224492 -- sub-0025864_ses-1_dwi_DS72784
#+ attr: name (g/c), name (v/c), hemisphere (v/c), tissue (v/c), Y
#| (v/c), weight (e/n)

table(V(glist[[1]])$hemisphere)
# left right 
#20412 20401 

table(V(glist[[1]])$tissue)
# gray white 
#19353 21460 

table(V(glist[[1]])$Y)
#   LG    LW    RG    RW 
# 9664 10748  9689 10712 
```

```{r, echo=FALSE, eval=TRUE, fig.show='hold', fig.width=4.5, fig.height=4.5, fig.cap="Summary of post-LCC of `DS72784` `binary`"}
library(TwoTruth)
data(twotruth)

twotruth %>% dplyr::select(c(2:8)) %>%
kable("html", escape=F, digits=2, align = "c", caption="Summary of post-LCC's of `DS72784`") %>%
	  kable_styling("striped", full_width = F) %>%
	  column_spec(1, bold = T) %>%
	  collapse_rows(columns = c(1:7)) %>%  #add_header_above(c(" " = 3, "scan 1" = 5, "scan 2" = 5)) %>%
	  scroll_box(width = "600px", height = "500px")

new.dd <- twotruth %>% dplyr::select(c(2:8)) %>% dplyr::select(-3) %>% gather(`n.LG`:`n.RW`, key="class", value="count") %>% unique()
new.dd$graph <- factor(new.dd$graph, levels=paste(sort(as.integer(levels(new.dd$graph)))))
new.dd$count <- as.integer(new.dd$count)
new.dd <- new.dd %>% mutate(ind=factor(paste(graph,scan)))
levels(new.dd$ind) <- as.character(1:length(levels(new.dd$ind)))
p1 <- ggplot(new.dd, aes(x=ind, y=count, fill=class)) +
	geom_bar(stat="identity") + #facet_grid(~scan) + 
	theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = "bottom") +
	theme(legend.title=element_blank()) +
	scale_x_discrete(breaks=as.character(seq(5,max(as.numeric(new.dd$ind)),by=5)))
print(p1)
p2 <- new.dd %>% filter(count>3000) %>%
	ggplot(aes(x=class, y=count, fill=class)) + 
    geom_point(aes(col=class), alpha=0.5, position = position_jitterdodge(jitter.width=0.3)) +
	geom_boxplot(alpha=0.7, notch=TRUE, outlier.size = 0) +
	theme(legend.title=element_blank(), legend.position = "bottom")
print(p2)
```

Note that there is one bad graph in the data set: subject 50 scan 2.  We have left this as is.


## `R` Package

To run the experiemnts in the paper, please follow these steps.  
(NB: All the codes are in the `demo` folder at [github](https://github.com/youngser/TwoTruth).)


```{r echo=TRUE}
require(devtools)
devtools::install_github("youngser/TwoTruth")
# WARNING: may take a while to install all the required packages
```

## Demos

To reproduce most of the Figures and Tables in the manuscript, please follow these steps:

```{r demo, eval=FALSE}
library(TwoTruth)

demo(doFig5)
demo(doFig6) 
demo(doFig7) 
```

# Software and Hardware Information

```{r vn,echo=TRUE, eval=TRUE}
library(help='TwoTruth')
sessionInfo()
```

-----
*prepared by <youngser@jhu.edu> on `r date()`*
